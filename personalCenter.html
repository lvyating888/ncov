<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>个人中心</title>
    <link rel="stylesheet" href="http://webimg.mp12345.com/jslib/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/personalCenter.css?v=0.2">
    <script src="http://webimg.mp12345.com/jslib/jquery/jquery.min.js"></script>
    <script src="http://webimg.mp12345.com/jslib/bootstrap/bootstrap.js"></script>
    <script src="js/common.js?v=0.2"></script>
    <script src="http://webimg.mp12345.com/jslib/layer/layer.js"></script>
    <script src="http://webimg.mp12345.com/jslib/ajaxDom.js?v=0.1"></script>
</head>
<body class="hasbotout">
<!-- 头部 -->
<div class="myselfbox clearfix">
    <div class="myselfleft">
        <p class="username"></p>
        <p class="compname">

        </p>
    </div>
    <div class="myselfright">
        <a href="javascript:;" class="signbtn" >
            签到
        </a>
        <!--<a href="javascript:;" class="signtext" style="display: none;">-->
        <!--已签到-->
        <!--</a>-->
    </div>
</div>
<!-- 底部 -->
<div class="innerout">
    <ul  class="mycontul">
        <li class="mycontlis is-admin" style="display:none;">
            <a href="healthWarning.html" class="per_smicon" id="per_body">
                    <span class="glyphicon glyphicon-warning-sign red" aria-hidden="true">
                    </span>
                <p>
                    健康预警
                </p>
                <i class="per_smiconpop" id="onetips" style="display: none;">1</i>
            </a>
        </li>
        <li class="mycontlis is-admin" style="display:none;">
            <a href="./publicly/releaseNotice.html" id="publishnew">
                <span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
                <p>
                    发布公告
                </p>
            </a>
        </li>

        <li class="mycontlis is-admin" style="display:none;">
            <a href="./datastatiStics.html" id="dataStatistics">
                <span class="glyphicon glyphicon-signal" aria-hidden="true"></span>
                <p>
                    人员数据
                </p>
            </a>
        </li>
        <li class="mycontlis is-admin" style="display:none;">
            <a href="./publicly/importExcal.html">
                <span class="glyphicon glyphicon-th" aria-hidden="true"></span>
                <p>
                    员工添加
                </p>
            </a>
        </li>
    </ul>
    <ul class="mycontul">
        <li class="mycontlis is-admin" style="display:none;">
            <a href="strators/tripRecord.html" id="tripRecord">
                <span class="glyphicon glyphicon-leaf" aria-hidden="true"></span>
                <p>
                    出行记录
                </p>
            </a>
        </li>
        <li class="mycontlis is-admin" style="display:none;">
            <a href="./sign/personalSignIn.html" id="signin">
                <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span>
                <p>
                    打卡记录
                </p>
            </a>
        </li>
        <li class="mycontlis is-admin" style="display:none;">
            <a href="createLink.html">
                <span class="glyphicon glyphicon-blackboard" aria-hidden="true"></span>
                <p>
                    电脑登录
                </p>
            </a>
        </li>
        <li class="mycontlis is-admin" style="display:none;" id="addVisitor">
            <a href="javascript:;" class="visitorbtn">
                <span class="glyphicon glyphicon-facetime-video" aria-hidden="true"></span>
                <p>
                    访客管理
                </p>
            </a>
        </li>
    </ul>
    <ul class="mycontul">
        <li class="mycontlis">
            <a href="./staffTravel.html" id="usergo">
                <span class="glyphicon glyphicon-globe" aria-hidden="true"></span>
                <p>
                    人员出行
                </p>
            </a>
        </li>
        <li class="mycontlis" >
            <a href="./noticeReminderList.html" id="publishgo">
                <span class="glyphicon glyphicon-envelope" aria-hidden="true"></span>
                <p>
                    公告列表
                </p>
            </a>
        </li>
        <li class="mycontlis">
            <a href="https://webimg.mp12345.com/NCP2020/yiqing.html" >
                <span class="glyphicon glyphicon-screenshot" aria-hidden="true"></span>
                <p>
                    疫情数据
                </p>
            </a>
        </li>
        <li class="mycontlis" id="addfamilybtn">
            <a href="familyfile/addfamily.html" >
                <span class="glyphicon glyphicon-home" aria-hidden="true"></span>
                <p>
                    多人考勤
                </p>
            </a>
        </li>
    </ul>
    <ul  class="mycontul clearfix">
        <li class="mycontlis is-admin " style="display:none;float: left;" id="addCheckbtn">
            <a href="javascript:;" class="checkbtn" >
                <span class="glyphicon glyphicon-info-sign" aria-hidden="true">
                </span>
                <p>
                    考勤委托
                </p>
            </a>
        </li>
        <li class="mycontlis is-admin " style="display:none;float: left;">
            <a href="javascript:;" class="setingbtn" >
                <span class="glyphicon glyphicon-cog" aria-hidden="true">
                </span>
                <p>
                    设置
                </p>
            </a>
        </li>
    </ul>

</div>
<!--#include file="/ncov/navBottom.html"-->
</body>
</html>
<script>
    /*-- 获取openid 是否注册过 假设openId=001--*/
    var openId = GetQueryValue('openId');
    $(function () {
        $('.signbtn').attr('href','./sign/punchClock.html?openId='+openId);
        $('.visitorbtn').attr('href','publicly/visitorManager.html?openId='+openId);
        $('.setingbtn').attr('href','mainseting.html?openId='+openId);
        $('.checkbtn').attr('href','publicly/checkCode.html?openId='+openId)
    })
    /*-- 获取用户填写的信息 --*/
    $.ajaxDom('body',{
        type: "get",
        url: '/ncov/isExist.json',
        data: {openId: openId},
        success: function (dataInfo) {
            if (dataInfo.success) {
                /*-- 获取注册的用户信息 --*/
                $.ajaxDom('body',{
                    type: "get",
                    url: '/member/info.json',
                    data: {openId: openId},
                    success: function (data) {
                        if (data.data) {
                            $('.username').html(data.data.name);
                            $('.compname').html(data.data.company);
                            if (data.data.admin == 1) {
                                $('.is-admin').show();
                            } else if (data.data.admin == 0) {
                                $('.is-admin').hide();
                            }
                            /*ticket 访客 register 考勤管理 family_add 多人考勤 */
                            if(dataInfo.data.compMap.ticket!==''){
                                $('#addVisitor').show();
                            }else{
                                $('#addVisitor').hide();
                            }
                            if(dataInfo.data.compMap.register!==''){
                                $('#addCheckbtn').show();
                            }else{
                                $('#addCheckbtn').hide();
                            }
                            if(dataInfo.data.compMap.family_add){
                                $('#addfamilybtn').show();
                            }else{
                                $('#addfamilybtn').hide();
                            }
                        }
                    }
                })
            } else {
                layer.msg("请先输入个人信息", function () {
                    window.location.href = 'index.html?openId=' + openId;
                });
            }
        }
    });
    // whetherSign();

    /*--判断用户是否签到--*/
    function whetherSign() {
        $.ajax({
            type: "get",
            url: '/member/isSign.json',
            data: {
                openId: openId
            },
            success: function (data) {
                console.log(data);
                if (data.data) {
                    $('.signbtn').hide();
                    $('.signtext').show();
                } else {
                    $('.signbtn').show();
                    $('.signtext').hide();
                }
            }
        })
    }

    /*-- 用户签到 --*/
    function signInfo() {
        $.ajax({
            type: "get",
            url: "/member/sign.json",
            data: {openId: openId},
            success: function (data) {
                if (data.success) {
                    whetherSign();
                    layer.msg('签到成功')
                } else {
                    /*layer.msg('签到失败，联系管理员')*/
                    layer.msg(data.message)
                }
            }
        })
    }

    /*-- 获取红色人员信息 onetips --*/
    $(function () {
        $.ajaxDom('#per_body',{
            type: 'get',
            url: '/publish/member/early/list.json',
            success: function (data) {
                if (data.data.data.length > 0) {
                    $('#onetips').show();
                    $('#onetips').html(data.data.totalCount)
                } else {
                    $('#onetips').hide();
                }
            }
        })
    })


</script>